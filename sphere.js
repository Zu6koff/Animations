const c=document.querySelector("#sphere-canvas");c.style.setProperty("--window_width",window.innerWidth),window.addEventListener("resize",()=>{c.style.setProperty("--window_width",window.innerWidth)});var w=c.width=c.parentElement.clientWidth,h=c.height=c.parentElement.clientHeight,ctx=c.getContext("2d"),opts={range:180,baseConnections:3,addedConnections:5,baseSize:5,minSize:1,dataToConnectionSize:.4,sizeMultiplier:.7,allowedDist:40,baseDist:40,addedDist:30,connectionAttempts:100,dataToConnections:1,baseSpeed:.04,addedSpeed:.05,baseGlowSpeed:.4,addedGlowSpeed:.4,rotVelX:.003,rotVelY:.002,repaintColor:"RGBA(9,7,9,100)",connectionColor:"rgba(85, 84, 85, 1)",rootColor:"rgba(0, 209, 255, 1)",endColor:"rgba(255, 92, 0, 1)",dataColor:"rgba(0, 209, 255, 1)",wireframeWidth:.2,wireframeColor:"rgba(85, 84, 85, 1)",depth:250,focalLength:250,vanishPoint:{x:w/2,y:h/2}},squareRange=opts.range*opts.range,squareAllowed=opts.allowedDist*opts.allowedDist,mostDistant=opts.depth+opts.range,sinX=sinY=0,cosX=cosY=0,connections=[],toDevelop=[],data=[],all=[],tick=0,totalProb=0,animating=!1,Tau=2*Math.PI;function init(){connections.length=0,data.length=0,all.length=0,toDevelop.length=0;var t=new Connection(0,0,0,opts.baseSize);for(t.step=Connection.rootStep,connections.push(t),all.push(t),t.link();toDevelop.length>0;)toDevelop[0].link(),toDevelop.shift();animating||(animating=!0,anim())}function Connection(t,e,s,n){this.x=t,this.y=e,this.z=s,this.size=n,this.screen={},this.links=[],this.probabilities=[],this.isEnd=!1,this.glowSpeed=opts.baseGlowSpeed+opts.addedGlowSpeed*Math.random()}function Data(t){this.glowSpeed=opts.baseGlowSpeed+opts.addedGlowSpeed*Math.random(),this.speed=opts.baseSpeed+opts.addedSpeed*Math.random(),this.screen={},this.setConnection(t)}function squareDist(t,e){var s=e.x-t.x,n=e.y-t.y,i=e.z-t.z;return s*s+n*n+i*i}function anim(){window.requestAnimationFrame(anim),ctx.globalCompositeOperation="source-over",ctx.fillStyle=opts.repaintColor,ctx.fillRect(0,0,w,h);var t=++tick*opts.rotVelX,e=tick*opts.rotVelY;if(cosX=Math.cos(t),sinX=Math.sin(t),cosY=Math.cos(e),sinY=Math.sin(e),data.length<connections.length*opts.dataToConnections){var s=new Data(connections[0]);data.push(s),all.push(s)}ctx.globalCompositeOperation="lighter",ctx.beginPath(),ctx.lineWidth=opts.wireframeWidth,ctx.strokeStyle=opts.wireframeColor,all.map(function(t){t.step()}),ctx.stroke(),ctx.globalCompositeOperation="source-over",all.sort(function(t,e){return e.screen.z-t.screen.z}),all.map(function(t){t.draw()})}ctx.fillStyle="#222",ctx.fillRect(0,0,w,h),ctx.fillStyle="#ccc",ctx.font="50px Verdana",ctx.fillText("Calculating Nodes",w/2-ctx.measureText("Calculating Nodes").width/2,h/2-15),window.setTimeout(init,4),Connection.prototype.link=function(){if(this.size<opts.minSize)return this.isEnd=!0;for(var t,e,s,n,i,o,r,a,l,p=[],d=opts.baseConnections+Math.random()*opts.addedConnections|0,x=opts.connectionAttempts,$={};p.length<d&&--x>0;)if(t=Math.random()*Math.PI,e=Math.random()*Tau,s=opts.baseDist+opts.addedDist*Math.random(),n=Math.cos(t),i=Math.sin(t),o=Math.cos(e),r=Math.sin(e),$.x=this.x+s*n*r,$.y=this.y+s*i*r,$.z=this.z+s*o,$.x*$.x+$.y*$.y+$.z*$.z<squareRange){a=!0,l=!0;for(var g=0;g<connections.length;++g)squareDist($,connections[g])<squareAllowed&&(a=!1);if(a)for(var g=0;g<p.length;++g)squareDist($,p[g])<squareAllowed&&(l=!1);a&&l&&p.push({x:$.x,y:$.y,z:$.z})}if(0===p.length)this.isEnd=!0;else{for(var g=0;g<p.length;++g){var $=p[g],y=new Connection($.x,$.y,$.z,this.size*opts.sizeMultiplier);this.links[g]=y,all.push(y),connections.push(y)}for(var g=0;g<this.links.length;++g)toDevelop.push(this.links[g])}},Connection.prototype.step=function(){this.setScreen(),this.screen.color=(this.isEnd?opts.endColor:opts.connectionColor).replace("light",30+tick*this.glowSpeed%30).replace("alp",.2+(1-this.screen.z/mostDistant)*.8);for(var t=0;t<this.links.length;++t)ctx.moveTo(this.screen.x,this.screen.y),ctx.lineTo(this.links[t].screen.x,this.links[t].screen.y)},Connection.rootStep=function(){this.setScreen(),this.screen.color=opts.rootColor.replace("light",30+tick*this.glowSpeed%30).replace("alp",(1-this.screen.z/mostDistant)*.8);for(var t=0;t<this.links.length;++t)ctx.moveTo(this.screen.x,this.screen.y),ctx.lineTo(this.links[t].screen.x,this.links[t].screen.y)},Connection.prototype.draw=function(){ctx.fillStyle=this.screen.color,ctx.beginPath(),ctx.arc(this.screen.x,this.screen.y,this.screen.scale*this.size,0,Tau),ctx.fill()},Data.prototype.reset=function(){this.setConnection(connections[0]),this.ended=2},Data.prototype.step=function(){this.proportion+=this.speed,this.proportion<1?(this.x=this.ox+this.dx*this.proportion,this.y=this.oy+this.dy*this.proportion,this.z=this.oz+this.dz*this.proportion,this.size=(this.os+this.ds*this.proportion)*opts.dataToConnectionSize):this.setConnection(this.nextConnection),this.screen.lastX=this.screen.x,this.screen.lastY=this.screen.y,this.setScreen(),this.screen.color=opts.dataColor.replace("light",40+tick*this.glowSpeed%50).replace("alp",.2+(1-this.screen.z/mostDistant)*.6)},Data.prototype.draw=function(){if(this.ended)return--this.ended;ctx.beginPath(),ctx.strokeStyle=this.screen.color,ctx.lineWidth=this.size*this.screen.scale,ctx.moveTo(this.screen.lastX,this.screen.lastY),ctx.lineTo(this.screen.x,this.screen.y),ctx.stroke()},Data.prototype.setConnection=function(t){t.isEnd?this.reset():(this.connection=t,this.nextConnection=t.links[t.links.length*Math.random()|0],this.ox=t.x,this.oy=t.y,this.oz=t.z,this.os=t.size,this.nx=this.nextConnection.x,this.ny=this.nextConnection.y,this.nz=this.nextConnection.z,this.ns=this.nextConnection.size,this.dx=this.nx-this.ox,this.dy=this.ny-this.oy,this.dz=this.nz-this.oz,this.ds=this.ns-this.os,this.proportion=0)},Connection.prototype.setScreen=Data.prototype.setScreen=function(){var t=this.x,e=this.y,s=this.z,n=e;e=e*cosX-s*sinX;var i=s=s*cosX+n*sinX;s=s*cosY-t*sinY,t=t*cosY+i*sinY,this.screen.z=s,s+=opts.depth,this.screen.scale=opts.focalLength/s,this.screen.x=opts.vanishPoint.x+t*this.screen.scale,this.screen.y=opts.vanishPoint.y+e*this.screen.scale};
